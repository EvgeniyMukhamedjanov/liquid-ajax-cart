const t="liquid-ajax-cart",e="data-ajax-cart",n="ajax-cart",o="js-ajax-cart",i=`${t}:init`;var r=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{u(o.next(t))}catch(t){r(t)}}function s(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((o=o.apply(t,e||[])).next())}))};const a="add",s="change",u="update",c="clear",l="get",d=`${t}:queue-start`,f=`${t}:queue-start-internal`,h=`${t}:queue-empty-internal`,p=`${t}:queue-end-internal`,m=`${t}:queue-end`,v=`${t}:request-start-internal`,y=`${t}:request-start`,b=`${t}:request-end-internal`,g=`${t}:request-end`,q=[];let $=!1;function w(t){var e;(null===(e=t.options)||void 0===e?void 0:e.important)&&0!==q.length?q[0].push(t):1===q.push([t])&&(E(!0),A())}function A(){if(1===q.length&&0===q[0].length){const t=new CustomEvent(h);document.dispatchEvent(t)}if(0===q.length)return void E(!1);if(0===q[0].length)return q.shift(),void A();const{requestType:t,body:e,options:n}=q[0][0];!function(t,e,n,o){const{extraRequestOnError:i}=W,s=D(t);let u;t!==l&&(u=e||{});const c=t===l?"GET":"POST",d=n.info||{},f={requestType:t,endpoint:s,requestBody:u,info:d},h=[],p=[],m=new CustomEvent(v,{detail:{requestState:{requestType:t,endpoint:s,info:d,requestBody:u}}});document.dispatchEvent(m);const b=new CustomEvent(y,{detail:{requestState:{requestType:t,endpoint:s,info:d,requestBody:u}}});if(document.dispatchEvent(b),d.cancel)return f.responseData=null,void L(n,o,f);if(void 0!==u){let e;if(u instanceof FormData||u instanceof URLSearchParams?u.has("sections")&&(e=u.get("sections").toString()):e=u.sections,"string"==typeof e||e instanceof String||Array.isArray(e)){if(Array.isArray(e)?h.push(...e):h.push(...e.split(",")),a===t&&p.push(...h.slice(0,5)),h.length>5){p.push(...h.slice(5));const t=h.slice(0,5).join(",");u instanceof FormData||u instanceof URLSearchParams?u.set("sections",t):u.sections=t}}else null!=e&&console.error(`Liquid Ajax Cart: "sections" parameter in a Cart Ajax API request must be a string or an array. Now it is ${e}`)}const g={method:c};t!==l&&(u instanceof FormData||u instanceof URLSearchParams?(g.body=u,g.headers={"x-requested-with":"XMLHttpRequest"}):(g.body=JSON.stringify(u),g.headers={"Content-Type":"application/json"})),fetch(s,g).then((t=>r(this,void 0,void 0,(function*(){const e=yield t.json();return{ok:t.ok,status:t.status,body:e}})))).then((t=>r(this,void 0,void 0,(function*(){return f.responseData=t,!f.responseData.ok&&i&&p.unshift(...h.slice(0,5)),p.length>0&&(f.extraResponseData=yield S(p)),f})))).catch((t=>{console.error("Liquid Ajax Cart: Error while performing cart Ajax request"),console.error(t),f.responseData=null,f.fetchError=t})).finally((()=>{L(n,o,f)}))}(t,e,n,(()=>{q[0].shift(),A()}))}function E(t){$=t;const e=new CustomEvent($?f:p);document.dispatchEvent(e);const n=new CustomEvent($?d:m);document.dispatchEvent(n)}function L(t,e,n){if("firstCallback"in t)try{t.firstCallback(n)}catch(t){console.error('Liquid Ajax Cart: Error in request "firstCallback" function'),console.error(t)}const o={requestState:n},i=new CustomEvent(b,{detail:o});document.dispatchEvent(i);const r=new CustomEvent(g,{detail:o});if(document.dispatchEvent(r),"lastCallback"in t)try{t.lastCallback(n)}catch(t){console.error('Liquid Ajax Cart: Error in request "lastCallback" function'),console.error(t)}e()}function S(t=[]){const e={updates:{}};return t.length>0&&(e.sections=t.slice(0,5).join(",")),fetch(D(u),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json().then((n=>{const o={ok:e.ok,status:e.status,body:n};return t.length<6?o:S(t.slice(5)).then((t=>{var e;return t.ok&&(null===(e=t.body)||void 0===e?void 0:e.sections)&&"object"==typeof t.body.sections&&("sections"in o.body||(o.body.sections={}),o.body.sections=Object.assign(Object.assign({},o.body.sections),t.body.sections)),o}))}))))}function j(t={}){w({requestType:l,body:void 0,options:t})}function x(t={},e={}){w({requestType:a,body:t,options:e})}function C(t={},e={}){w({requestType:s,body:t,options:e})}function T(t={},e={}){w({requestType:u,body:t,options:e})}function k(t={},e={}){w({requestType:c,body:t,options:e})}function D(t){var e,n,o,i,r,d,f,h,p,m;switch(t){case a:return`${(null===(n=null===(e=window.Shopify)||void 0===e?void 0:e.routes)||void 0===n?void 0:n.root)||"/"}cart/add.js`;case s:return`${(null===(i=null===(o=window.Shopify)||void 0===o?void 0:o.routes)||void 0===i?void 0:i.root)||"/"}cart/change.js`;case l:return`${(null===(d=null===(r=window.Shopify)||void 0===r?void 0:r.routes)||void 0===d?void 0:d.root)||"/"}cart.js`;case c:return`${(null===(h=null===(f=window.Shopify)||void 0===f?void 0:f.routes)||void 0===h?void 0:h.root)||"/"}cart/clear.js`;case u:return`${(null===(m=null===(p=window.Shopify)||void 0===p?void 0:p.routes)||void 0===m?void 0:m.root)||"/"}cart/update.js`;default:return}}function _(){return $}const O=`${e}-initial-state`;let R,N=null;function M(){return{cart:N,previousCart:R}}const B=`${e}-bind`;function H(){M().cart&&document.querySelectorAll(`[${B}]`).forEach((t=>{const e=t.getAttribute(B);t.textContent=function(t){const{binderFormatters:e}=W,[n,...o]=t.split("|");let i=F(n,M().cart);return o.forEach((t=>{const n=t.trim();""!==n&&("object"==typeof e&&n in e?i=e[n](i):n in U?i=U[n](i):console.warn(`Liquid Ajax Cart: the "${n}" formatter is not found`))})),"string"==typeof i||i instanceof String||"number"==typeof i||i instanceof Number?i.toString():(console.error(`Liquid Ajax Cart: the calculated value for the ${B}="${t}" element must be string or number. But the value is`,i),"")}(e)}))}function F(t,e){const n=t.split("."),o=n.shift().trim();return""!==o&&o in e&&n.length>0?F(n.join("."),e[o]):e[o]}const U={money_with_currency:t=>{var e;const n=M();if("number"!=typeof t&&!(t instanceof Number))return console.error("Liquid Ajax Cart: the 'money_with_currency' formatter is not applied because the value is not a number. The value is ",t),t;const o=t/100;return"Intl"in window&&(null===(e=window.Shopify)||void 0===e?void 0:e.locale)?Intl.NumberFormat(window.Shopify.locale,{style:"currency",currency:n.cart.currency}).format(o):`${o.toFixed(2)} ${n.cart.currency}`}};let P,I=!1;function J(){const{mutations:t}=W;Array.isArray(t)||console.error('Liquid Ajax Cart: the "mutations" settings parameter must be an array'),0!==t.length&&(I=!1,P=-1,V())}function V(){const{mutations:t}=W;if(P++,P>=t.length)return;let e=[];try{const n=t[P]();n&&(e=(null==n?void 0:n.requests)||[])}catch(t){console.error(`Liquid Ajax Cart: Error in the "mutation" function with index ${P}`),console.error(t)}Array.isArray(e)?Z(e):V()}function Z(t){const e=t.shift();if(e){if(e.type&&[a,s,u,c,l].includes(e.type))return void w({requestType:e.type,body:e.body,options:{info:{initiator:"mutation"},important:!0,lastCallback:e=>{Z(t)}}});console.error(`Liquid Ajax Cart: wrong request type in the mutation with index ${P}`)}t.length>0?Z(t):V()}const W={binderFormatters:{},requestErrorText:"There was an error while updating your cart. Please try again.",updateOnWindowFocus:!0,quantityTagAllowZero:!1,quantityTagDebounce:300,mutations:[],extraRequestOnError:!0},z=`${e}-section`,G=`${e}-static-element`,K=`${e}-section-scroll`,X="shopify-section-";var Q,Y,tt,et,nt,ot,it,rt;const at=`${n}-form`,st="processing",ut=`${(null===(Y=null===(Q=window.Shopify)||void 0===Q?void 0:Q.routes)||void 0===Y?void 0:Y.root)||"/"}cart/change`,ct=`${(null===(et=null===(tt=window.Shopify)||void 0===tt?void 0:tt.routes)||void 0===et?void 0:et.root)||"/"}cart/add`,lt=`${(null===(ot=null===(nt=window.Shopify)||void 0===nt?void 0:nt.routes)||void 0===ot?void 0:ot.root)||"/"}cart/clear`,dt=`${(null===(rt=null===(it=window.Shopify)||void 0===it?void 0:it.routes)||void 0===rt?void 0:rt.root)||"/"}cart/update`;class ft extends HTMLElement{connectedCallback(){const t=this,e=this.querySelectorAll("form");if(1!==e.length)return void console.error(`Liquid Ajax Cart: "${at}" element must have one "form" element as a child, ${e.length} found`,t);const n=e[0],o=new URL(n.action);[ut,ct,lt,dt].includes(o.pathname)?n.addEventListener("submit",(e=>{if(!t.hasAttribute(st)){const e=new FormData(n);switch(t.setAttribute(st,""),o.pathname){case ct:x(e,{lastCallback:()=>{t.removeAttribute(st)},info:{initiator:t}});break;case ut:C(e,{lastCallback:()=>{t.removeAttribute(st)},info:{initiator:t}});break;case dt:T(e,{lastCallback:()=>{t.removeAttribute(st)},info:{initiator:t}});break;case lt:k({},{lastCallback:()=>{t.removeAttribute(st)},info:{initiator:t}})}}e.preventDefault()})):console.error(`Liquid Ajax Cart: "${at}" element's form "action" attribute value contains an invalid URL`,`URL should be one of the following: ${ut}, ${ct}, ${dt}, ${lt}`,n,t)}}var ht,pt,mt,vt,yt,bt,gt,qt;const $t=`${(null===(pt=null===(ht=window.Shopify)||void 0===ht?void 0:ht.routes)||void 0===pt?void 0:pt.root)||"/"}cart/change`,wt=`${(null===(vt=null===(mt=window.Shopify)||void 0===mt?void 0:mt.routes)||void 0===vt?void 0:vt.root)||"/"}cart/add`,At=`${(null===(bt=null===(yt=window.Shopify)||void 0===yt?void 0:yt.routes)||void 0===bt?void 0:bt.root)||"/"}cart/clear`,Et=`${(null===(qt=null===(gt=window.Shopify)||void 0===gt?void 0:gt.routes)||void 0===qt?void 0:qt.root)||"/"}cart/update`,Lt=`${e}-request-button`;function St(t,e){let n;const o=[$t,wt,At,Et];if(!t.hasAttribute(Lt))return;const i=t.getAttribute(Lt);if(i){let t;try{if(t=new URL(i,window.location.origin),!o.includes(t.pathname))throw`URL should be one of the following: ${$t}, ${wt}, ${Et}, ${At}`;n=t}catch(t){console.error(`Liquid Ajax Cart: ${Lt} contains an invalid URL as a parameter.`,t)}}else if(t instanceof HTMLAnchorElement&&t.hasAttribute("href")){const e=new URL(t.href);o.includes(e.pathname)?n=e:t.hasAttribute(Lt)&&console.error(`Liquid Ajax Cart: a link with the ${Lt} contains an invalid href URL.`,`URL should be one of the following: ${$t}, ${wt}, ${Et}, ${At}`)}if(void 0===n)return void console.error(`Liquid Ajax Cart: a ${Lt} element doesn't have a valid URL`);if(e&&e.preventDefault(),_())return;const r=new FormData;switch(n.searchParams.forEach(((t,e)=>{r.append(e,t)})),n.pathname){case wt:x(r,{info:{initiator:t}});break;case $t:C(r,{info:{initiator:t}});break;case Et:T(r,{info:{initiator:t}});break;case At:k({},{info:{initiator:t}})}}function jt(t,e){let n,o;return t.length>3?(n=e.cart.items.find((e=>e.key===t)),o="id"):(n=e.cart.items[Number(t)-1],o="line"),void 0===n&&(n=null,console.error(`Liquid Ajax Cart: line item with ${o}="${t}" not found`)),[n,o]}const xt=`${e}-quantity-input`;function Ct(t){return!(!t.hasAttribute(xt)||!(t instanceof HTMLInputElement&&["text","number"].includes(t.type)||t instanceof HTMLSelectElement&&["select-one"].includes(t.type))&&(console.error(`Liquid Ajax Cart: the ${xt} attribute supports "input" elements of types "text", "number" and non-multiple "select" elements`),1))}function Tt(){document.querySelectorAll(`input[${xt}], select[${xt}]`).forEach((t=>{if(!Ct(t))return;if(_())return void(t.disabled=!0);const e=M(),n=t.getAttribute(xt).trim(),[o]=jt(n,e);o?t.value=o.quantity.toString():null===o&&(t.value="0"),t.disabled=!1}))}function kt(t,e){if(!Ct(t))return;if(e&&e.preventDefault(),_())return;let n=Number(t.value.trim());const o=t.getAttribute(xt).trim();if(isNaN(n))return void console.error(`Liquid Ajax Cart: input value of a ${xt} must be an Integer number`);if(n<1&&(n=0),!o)return void console.error(`Liquid Ajax Cart: attribute value of a ${xt} must be an item key or an item index`);const i=o.length>3?"id":"line",r=new FormData;r.set(i,o),r.set("quantity",n.toString()),C(r,{info:{initiator:t}}),t.blur()}const Dt=`${e}-property-input`;function _t(t){const e=t.getAttribute(Dt),n=t.getAttribute("name");console.error(`Liquid Ajax Cart: the element [${Dt}="${e}"]${n?`[name="${n}"]`:""} has wrong attributes.`)}function Ot(t){return!!t.hasAttribute(Dt)&&!!(t instanceof HTMLInputElement&&"hidden"!==t.type||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)}function Rt(t){const e={objectCode:void 0,propertyName:void 0,attributeValue:void 0};if(!t.hasAttribute(Dt))return e;let n=t.getAttribute(Dt).trim();if(!n){const e=t.getAttribute("name").trim();e&&(n=e)}if(!n)return _t(t),e;if(e.attributeValue=n,"note"===n)return e.objectCode="note",e;let[o,...i]=n.trim().split("[");return!i||1!==i.length||i[0].length<2||i[0].indexOf("]")!==i[0].length-1?(_t(t),e):(e.objectCode=o,e.propertyName=i[0].replace("]",""),e)}function Nt(){document.querySelectorAll(`[${Dt}]`).forEach((t=>{if(!Ot(t))return;if(_())return void(t.disabled=!0);const{objectCode:e,propertyName:n,attributeValue:o}=Rt(t);if(!e)return;const i=M();let r,a=!1;if("note"===e)r=i.cart.note;else if("attributes"===e)r=i.cart.attributes[n];else{const[t,s]=jt(e,i);t&&(r=t.properties[n]),null===t&&(console.error(`Liquid Ajax Cart: line item with ${s}="${e}" was not found when the [${Dt}] element with "${o}" value tried to get updated from the State`),a=!0)}t instanceof HTMLInputElement&&("checkbox"===t.type||"radio"===t.type)?t.checked=t.value===r:("string"==typeof r||r instanceof String||"number"==typeof r||r instanceof Number||(Array.isArray(r)||r instanceof Object?(r=JSON.stringify(r),console.warn(`Liquid Ajax Cart: the ${Dt} with the "${o}" value is bound to the ${n} ${"attributes"===e?"attribute":"property"} that is not string or number: ${r}`)):r=""),t.value=r),a||(t.disabled=!1)}))}function Mt(t,e){if(!Ot(t))return;e&&e.preventDefault(),t.blur();const n=M();if(_())return;const{objectCode:o,propertyName:i,attributeValue:r}=Rt(t);if(!o)return;let a=t.value;if(t instanceof HTMLInputElement&&"checkbox"===t.type&&!t.checked){let t=document.querySelector(`input[type="hidden"][${Dt}="${r}"]`);t||"note"!==o&&"attributes"!==o||(t=document.querySelector(`input[type="hidden"][${Dt}][name="${r}"]`)),a=t?t.value:""}if("note"===o){const e=new FormData;e.set("note",a),T(e,{info:{initiator:t}})}else if("attributes"===o){const e=new FormData;e.set(`attributes[${i}]`,a),T(e,{info:{initiator:t}})}else{const[e,s]=jt(o,n);if(null===e&&console.error(`Liquid Ajax Cart: line item with ${s}="${o}" was not found when the [${Dt}] element with "${r}" value tried to update the cart`),!e)return;const u=Object.assign({},e.properties);u[i]=a;const c=new FormData;let l=c;c.set(s,o),c.set("quantity",e.quantity.toString());for(let t in u){const n=u[t];"string"==typeof n||n instanceof String?c.set(`properties[${t}]`,u[t]):l={[s]:o,quantity:e.quantity,properties:u}}C(l,{info:{initiator:t}})}}const Bt=`${n}-quantity`,Ht=`${e}-quantity-plus`,Ft=`${e}-quantity-minus`;function Ut(){customElements.define(at,ft),document.addEventListener("click",(function(t){for(let e=t.target;e&&e!=document.documentElement;e=e.parentElement)St(e,t)}),!1),document.addEventListener("change",(function(t){Mt(t.target,t)}),!1),document.addEventListener("keydown",(function(t){const e=t.target;"Enter"===t.key&&(e instanceof HTMLTextAreaElement&&!t.ctrlKey||Mt(e,t)),"Escape"===t.key&&function(t){if(!Ot(t))return;if(!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement))return;if(t instanceof HTMLInputElement&&("checkbox"===t.type||"radio"===t.type))return;const e=M(),{objectCode:n,propertyName:o}=Rt(t);if(!n)return;let i;if("note"===n)i=e.cart.note;else if("attributes"===n)i=e.cart.attributes[o];else{const[t]=jt(n,e);t&&(i=t.properties[o])}void 0!==i&&(i||"string"==typeof i||i instanceof String||(i=""),t.value=String(i)),t.blur()}(e)}),!1),document.addEventListener(f,Nt),document.addEventListener(b,Nt),document.addEventListener(p,Nt),Nt(),document.addEventListener("change",(function(t){kt(t.target,t)}),!1),document.addEventListener("keydown",(function(t){"Enter"===t.key&&kt(t.target,t),"Escape"===t.key&&function(t){if(!Ct(t))return;const e=t.getAttribute(xt).trim();let n;const o=M();if(e.length>3)n=o.cart.items.find((t=>t.key===e));else{const t=Number(e)-1;n=o.cart.items[t]}n&&(t.value=n.quantity.toString()),t.blur()}(t.target)}),!1),document.addEventListener(f,Tt),document.addEventListener(b,Tt),document.addEventListener(p,Tt),Tt(),customElements.define(Bt,class extends HTMLElement{constructor(){super(...arguments),this._timer=void 0}connectedCallback(){const t=this.querySelectorAll("input");1===t.length?(this._$input=t[0],this._$input.hasAttribute(xt)?(this._$buttons=Array.from(this.querySelectorAll(`[${Ft}], [${Ht}]`)),this._$input.addEventListener("change",this._updateDOM.bind(this)),document.addEventListener(f,this._updateDOM.bind(this)),document.addEventListener(b,this._updateDOM.bind(this)),document.addEventListener(p,this._updateDOM.bind(this)),this._updateDOM(),this._$buttons.forEach((t=>{t.addEventListener("click",(e=>{const{quantityTagAllowZero:n}=W,o=!0===n?0:1;if(!_()){const e=Number(this._$input.value);if(isNaN(e))return void console.error(`Liquid Ajax Cart: "${Bt}" element's input value isn't a number`,this._$input,this);let n=e,i=Number(this._$input.getAttribute("step")||1);(!Number.isSafeInteger(i)||i<=0)&&(i=1),n=t.hasAttribute(Ht)?n+i:n-i,n<o&&(n=o),n!==e&&(this._$input.value=n.toString(),this._runAwaiting(),this._updateDOM())}e.preventDefault()})),t.addEventListener("focusout",(e=>{e.relatedTarget&&t.contains(e.relatedTarget)||void 0!==this._timer&&this._runRequest()}))}))):console.error(`Liquid Ajax Cart: "${Bt}" element's input must have the "${xt}" attribute`,this._$input,this)):console.error(`Liquid Ajax Cart: "${Bt}" element must have one "input" element as a child, ${t.length} found`,this)}_runAwaiting(){const{quantityTagDebounce:t}=W;void 0!==this._timer&&clearTimeout(this._timer),t>0?this._timer=setTimeout((()=>{this._runRequest()}),Number(t)):this._runRequest()}_runRequest(){void 0!==this._timer&&clearTimeout(this._timer),this._timer=void 0,_()||this._$input.dispatchEvent(new Event("change",{bubbles:!0}))}_updateDOM(){this._$buttons.forEach((t=>{const e=_()||t.hasAttribute(Ft)&&!W.quantityTagAllowZero&&"1"===this._$input.value;e?t.setAttribute("aria-disabled","true"):t.removeAttribute("aria-disabled"),t instanceof HTMLButtonElement&&t.toggleAttribute("disabled",e)}))}}),customElements.define(`${n}-product-form`,class extends HTMLElement{constructor(){super(),console.error(`Liquid Ajax Cart: The <${n}-product-form> element is deprecated. Use <${n}-form> instead.`)}})}const Pt=`${e}-errors`,It=t=>{switch(t.requestType){case a:return(t=>{var e;const n=null===(e=t.info)||void 0===e?void 0:e.initiator;return n instanceof ft?Array.from(n.querySelectorAll(`[${Pt}="form"]`)):[]})(t);case s:return(t=>{var e;const n=[],o=M();let i,r;if(t.requestBody instanceof FormData||t.requestBody instanceof URLSearchParams?(t.requestBody.has("line")&&(r=t.requestBody.get("line").toString()),t.requestBody.has("id")&&(i=t.requestBody.get("id").toString())):("line"in t.requestBody&&(r=String(t.requestBody.line)),"id"in t.requestBody&&(i=String(t.requestBody.id))),r){const t=Number(r);if(t>0){const n=t-1;i=null===(e=o.cart.items[n])||void 0===e?void 0:e.key}}return i&&(i.indexOf(":")>-1?n.push(...Array.from(document.querySelectorAll(`[${Pt}="${i}"]`))):n.push(...Array.from(document.querySelectorAll(o.cart.items.reduce(((t,e)=>(e.key!==i&&e.id!==Number(i)||t.push(`[${Pt}="${e.key}"]`),t)),[]).join(","))))),n})(t);default:return[]}},Jt=`${o}-init`,Vt=`${o}-processing`,Zt=`${o}-empty`,Wt=`${o}-not-empty`;function zt(){const t=document.querySelector("html"),e=M();t.classList.toggle(Jt,null!==e.cart),t.classList.toggle(Vt,_()),t.classList.toggle(Zt,0===e.cart.item_count),t.classList.toggle(Wt,e.cart.item_count>0)}let Gt=!1;if(!("liquidAjaxCart"in window)){function Kt(t,e){Object.defineProperty(window.liquidAjaxCart,t,{get:e,set:()=>{throw new Error(`Liquid Ajax Cart: the "${t}" is a read-only property`)},enumerable:!0})}window.liquidAjaxCart={conf:function(t,e){t in W?(W[t]=e,window.liquidAjaxCart.init&&("binderFormatters"===t&&H(),"mutations"===t&&J())):console.error(`Liquid Ajax Cart: unknown configuration parameter "${t}"`)}},Kt("init",(()=>Gt)),document.addEventListener(v,(t=>{const{requestState:e}=t.detail;if(void 0!==e.requestBody){const t=[];if(document.querySelectorAll(`[${z}]`).forEach((e=>{const n=e.closest(`[id^="${X}"]`);if(n){const e=n.id.replace(X,"");-1===t.indexOf(e)&&t.push(e)}else console.error(`Liquid Ajax Cart: there is a ${z} element that is not inside a Shopify section. All the ${z} elements must be inside Shopify sections.`)})),t.length){let n,o=t.join(",");e.requestBody instanceof FormData||e.requestBody instanceof URLSearchParams?e.requestBody.has("sections")&&(n=e.requestBody.get("sections").toString()):n=e.requestBody.sections,(("string"==typeof n||n instanceof String)&&""!==n||n&&Array.isArray(n)&&n.length>0)&&(o=`${n.toString()},${o}`),e.requestBody instanceof FormData||e.requestBody instanceof URLSearchParams?e.requestBody.set("sections",o):e.requestBody.sections=o}}})),document.addEventListener(b,(t=>{var e,n,o,i;t.detail.sections=[];const{requestState:r}=t.detail,s=new DOMParser,u=[];if(r.responseData.body.sections||(null===(n=null===(e=r.extraResponseData)||void 0===e?void 0:e.body)||void 0===n?void 0:n.sections)){let t=r.responseData.body.sections;(null===(i=null===(o=r.extraResponseData)||void 0===o?void 0:o.body)||void 0===i?void 0:i.sections)&&(t=Object.assign(Object.assign({},t),r.extraResponseData.body.sections));for(let e in t)t[e]?document.querySelectorAll(`#shopify-section-${e}`).forEach((n=>{let o=[];const i="__noId__",c={};n.querySelectorAll(` [${K}] `).forEach((t=>{let e=t.getAttribute(K).toString().trim();""===e&&(e=i),e in c||(c[e]=[]),c[e].push({scroll:t.scrollTop,height:t.scrollHeight})}));const l={},d=n.querySelectorAll(`[${G}]`);d&&d.forEach((t=>{let e=t.getAttribute(G).toString().trim();""===e&&(e=i),e in l||(l[e]=[]),l[e].push(t)}));const f=n.querySelectorAll(`[${z}]`);if(f){const r=s.parseFromString(t[e],"text/html");r.querySelectorAll('img[loading="lazy"]').forEach((t=>{t.removeAttribute("loading")}));for(let t in l)r.querySelectorAll(` [${G}="${t.replace(i,"")}"] `).forEach(((e,n)=>{n+1<=l[t].length&&(e.before(l[t][n]),e.parentElement.removeChild(e))}));const a=r.querySelectorAll(`[${z}]`);if(f.length!==a.length){console.error(`Liquid Ajax Cart: the received HTML for the "${e}" section has a different quantity of the "${z}" containers. The section will be updated completely.`);const t=r.querySelector(`#${X}${e}`);if(t){for(n.innerHTML="";t.childNodes.length;)n.appendChild(t.firstChild);o.push(n)}}else f.forEach(((t,e)=>{t.before(a[e]),t.parentElement.removeChild(t),o.push(a[e])}))}for(let t in c)n.querySelectorAll(` [${K}="${t.replace(i,"")}"] `).forEach(((e,n)=>{n+1<=c[t].length&&(r.requestType!==a||c[t][n].height>=e.scrollHeight)&&(e.scrollTop=c[t][n].scroll)}));o.length>0&&u.push({id:e,elements:o})})):console.error(`Liquid Ajax Cart: the HTML for the "${e}" section was requested but the response is ${t[e]}`)}u.length>0&&(t.detail.sections=u)})),document.addEventListener(v,(t=>{const{requestState:e}=t.detail;It(e).forEach((t=>{t.textContent=""}))})),document.addEventListener(b,(t=>{const{requestState:e}=t.detail;if(e.info.cancel)return;const n=It(e);if(0===n.length)return;const o=function(t){var e,n,o,i,r,a,s;const{requestErrorText:u}=W;if(null===(e=t.responseData)||void 0===e?void 0:e.ok)return"";const c=(null===(o=null===(n=t.responseData)||void 0===n?void 0:n.body)||void 0===o?void 0:o.errors)||(null===(r=null===(i=t.responseData)||void 0===i?void 0:i.body)||void 0===r?void 0:r.description)||(null===(s=null===(a=t.responseData)||void 0===a?void 0:a.body)||void 0===s?void 0:s.message);return c?"string"==typeof c?c:"object"==typeof c?Object.values(c).map((t=>t.join(", "))).join("; "):u:u}(e);o&&n.forEach((t=>{t.textContent=o}))})),document.addEventListener(i,J),document.addEventListener(h,(()=>{I&&J()})),document.addEventListener(v,(t=>{const{requestState:e}=t.detail;"mutation"!==e.info.initiator&&(I=!0)})),function(){document.addEventListener(b,(t=>{var e,n;const{requestState:o}=t.detail;let i;(null===(e=o.extraResponseData)||void 0===e?void 0:e.ok)&&o.extraResponseData.body.token?i=o.extraResponseData.body:(null===(n=o.responseData)||void 0===n?void 0:n.ok)&&o.responseData.body.token&&(i=o.responseData.body),i&&(R=N,N=i,t.detail.previousCart=R,t.detail.cart=N)}));const t=document.querySelector(`[${O}]`);if(t)try{N=JSON.parse(t.textContent)}catch(t){console.error(`Liquid Ajax Cart: can't parse cart JSON from the "${O}" script`),console.error(t)}return new Promise(((t,e)=>{var n,o;N?t():fetch(`${(null===(o=null===(n=window.Shopify)||void 0===n?void 0:n.routes)||void 0===o?void 0:o.root)||"/"}cart.js`,{headers:{"Content-Type":"application/json"}}).then((t=>t.json())).then((e=>{N=e,t()})).catch((t=>{console.error(t),e('Can\'t load the cart state from the "/cart.js" endpoint')}))}))}().then((()=>{document.addEventListener(b,H),H(),Ut(),document.addEventListener(f,zt),document.addEventListener(b,zt),document.addEventListener(p,zt),zt(),window.liquidAjaxCart.get=j,window.liquidAjaxCart.add=x,window.liquidAjaxCart.change=C,window.liquidAjaxCart.update=T,window.liquidAjaxCart.clear=k,Kt("cart",(()=>M().cart)),Kt("processing",_),window.addEventListener("focus",(()=>{W.updateOnWindowFocus&&T({},{})})),window.addEventListener("pageshow",(t=>{(t.persisted||"back_forward"===performance.getEntriesByType("navigation")[0].type)&&window.liquidAjaxCart.update({},{})})),Gt=!0;const t=new CustomEvent(i);document.dispatchEvent(t)}))}