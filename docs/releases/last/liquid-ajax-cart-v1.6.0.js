var t={d:(e,r)=>{for(var a in r)t.o(r,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{x$:()=>M,nd:()=>P,yF:()=>U,fi:()=>F,Be:()=>O,ih:()=>D,KJ:()=>N,Q4:()=>I,w0:()=>H});const r={productFormsFilter:t=>!0,messageBuilder:t=>{let e="";return t.forEach((t=>{e+=`<div class="js-ajax-cart-message js-ajax-cart-message--${t.type}">${t.text}</div>`})),e},lineItemQuantityErrorText:"You can't add more of this item to your cart",requestErrorText:"There was an error while updating your cart. Please try again.",updateOnWindowFocus:!0,computed:{productFormsErrorsAttribute:"data-ajax-cart-form-error",sectionsAttribute:"data-ajax-cart-section",binderAttribute:"data-ajax-cart-bind-state",requestButtonAttribute:"data-ajax-cart-request-button",toggleClassButtonAttribute:"data-ajax-cart-toggle-class-button",initialStateAttribute:"data-ajax-cart-initial-state",sectionScrollAreaAttribute:"data-ajax-cart-section-scroll",quantityInputAttribute:"data-ajax-cart-quantity-input",messagesAttribute:"data-ajax-cart-messages",configurationAttribute:"data-ajax-cart-configuration",cartStateSetBodyClass:"js-ajax-cart-set",requestInProgressBodyClass:"js-ajax-cart-request-in-progress",emptyCartBodyClass:"js-ajax-cart-empty",notEmptyCartBodyClass:"js-ajax-cart-not-empty",productFormsProcessingClass:"js-ajax-cart-form-in-progress"}},a=(t,e)=>{t in r&&"computed"!==t?r[t]=e:console.error(`Liquid Ajax Cart: unknown configuration parameter "${t}"`)},o=[],s=t=>{switch(t){case"add":return"/cart/add.js";case"change":return"/cart/change.js";case"get":return"/cart.js";case"clear":return"/cart/clear.js";case"update":return"/cart/update.js";default:return}},n=(t,e,r={})=>{const a=s(t);let n;"get"!==t&&(n=e||{});const i="get"===t?"GET":"POST",c=r.info||{},u="firstComplete"in r?[r.firstComplete]:[],d={requestType:t,endpoint:a};o.forEach((e=>{try{e({requestType:t,endpoint:a,info:c,requestBody:n},(t=>u.push(t)))}catch(t){console.error("Liquid Ajax Cart: Error during Ajax request subscriber callback in ajax-api"),console.error(t)}})),"lastComplete"in r&&u.push(r.lastComplete),d.requestBody=n,d.info=c;const l={method:i};"get"!==t&&(n instanceof FormData||n instanceof URLSearchParams?(l.body=n,l.headers={"x-requested-with":"XMLHttpRequest"}):(l.body=JSON.stringify(n),l.headers={"Content-Type":"application/json"})),fetch(a,l).then((t=>t.json().then((e=>({ok:t.ok,status:t.status,body:e}))))).then((e=>(d.responseData=e,"add"!==t?d:fetch(s("get"),{method:"GET",headers:{"Content-Type":"application/json"}}).then((t=>t.json().then((e=>(d.extraResponseData={ok:t.ok,status:t.status,body:e},d)))))))).catch((t=>{console.error("Liquid Ajax Cart: Error while performing cart Ajax request"),console.error(t),d.fetchError=t})).finally((()=>{u.forEach((t=>{try{t(d)}catch(t){console.error("Liquid Ajax Cart: Error during Ajax request result callback in ajax-api"),console.error(t)}}))}))},i=t=>{n("get",void 0,t)},c=(t,e)=>{n("add",t,e)},u=(t,e)=>{n("change",t,e)},d=(t,e)=>{n("update",t,e)},l=(t,e)=>{n("clear",t,e)},p=t=>{o.push(t)},m={all:0},f=[];let h={},y={requestInProgress:!1,cartStateSet:!1};const g=()=>{y.requestInProgress=m.all>0,y.cartStateSet="item_count"in h,A()},q=t=>{try{t({cart:h,status:y}),f.push(t)}catch(t){console.log("Liquid Ajax Cart: Error during subscribing to the state"),console.error(t)}},b=()=>({cart:h,status:y}),A=()=>{f.forEach((t=>{try{t({cart:h,status:y})}catch(t){console.error(t)}}))},S=t=>{const e=r.computed.binderAttribute;t.status.cartStateSet&&document.querySelectorAll(`[${e}]`).forEach((t=>{const r=t.getAttribute(e),a=j(r);void 0!==a&&(t.innerText=a)}))},j=t=>{const[e,...r]=t.split("|");let a=x(e);return r.forEach((t=>{const e=t.trim();""!==e&&(e in C?a=C[e](a):console.error(`Liquid Ajax Cart: the "${e}" formatter doesn't exist`))})),a};function x(t,e=b()){b();const r=t.split("."),a=r.shift().trim();return a in e&&r.length>0?x(r.join("."),e[a]):e[a]}const C={amount:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount }}")},amount_no_decimals:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount_no_decimals }}")},amount_with_comma_separator:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount_with_comma_separator }}")},amount_no_decimals_with_comma_separator:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount_no_decimals_with_comma_separator }}")},amount_with_apostrophe_separator:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount_with_apostrophe_separator }}")}};function L(t){const{requestButtonAttribute:e}=r.computed;let a;const o=["/cart/change","/cart/add","/cart/clear","/cart/update"];if(this.hasAttribute(e)){const t=this.getAttribute(e);if(t){let r;try{if(r=new URL(t,window.location.origin),!o.includes(r.pathname))throw"URL should be one of the following: /cart/change, /cart/add, /cart/update, /cart/clear";a=r}catch(t){console.error(`Liquid Ajax Cart: ${e} contains an invalid URL as a parameter.`,t)}}}if(void 0===a&&this.hasAttribute("href")&&"A"===this.tagName.toUpperCase()){const t=new URL(this.href);o.includes(t.pathname)?a=t:this.hasAttribute(e)&&console.error(`Liquid Ajax Cart: a link with the ${e} contains an invalid href URL.`,"URL should be one of the following: /cart/change, /cart/add, /cart/update, /cart/clear")}if(void 0===a)return;if(t.preventDefault(),b().status.requestInProgress)return;const s=new FormData;switch(a.searchParams.forEach(((t,e)=>{s.append(e,t)})),a.pathname){case"/cart/add":c(s,{info:{initiator:this}});break;case"/cart/change":u(s,{info:{initiator:this}});break;case"/cart/update":d(s,{info:{initiator:this}});break;case"/cart/clear":l({},{info:{initiator:this}})}}function w(t){const{toggleClassButtonAttribute:e}=r.computed;if(!this.hasAttribute(e))return;t.preventDefault();const a=this.getAttribute(e).split("|");if(!a)return void console.error("Liquid Ajax Cart: Error while toggling body class");const o=a[0].trim();let s=a[1]?a[1].trim():"toggle";if("add"!==s&&"remove"!==s&&(s="toggle"),o)try{"add"===s?document.body.classList.add(o):"remove"===s?document.body.classList.remove(o):document.body.classList.toggle(o)}catch(t){console.error("Liquid Ajax Cart: Error while toggling body class:",o),console.error(t)}}function E(t){const{quantityInputAttribute:e}=r.computed;if(!this.hasAttribute(e))return;if(t.preventDefault(),b().status.requestInProgress)return;let a=Number(this.value.trim());const o=this.getAttribute(e).trim();if(isNaN(a))return void console.error("Liquid Ajax Cart: input value of a data-ajax-cart-quantity-input must be an Integer number");if(a<1&&(a=0),!o)return void console.error("Liquid Ajax Cart: attribute value of a data-ajax-cart-quantity-input must be an item key or an item index");const s=o.length>3?"id":"line",n=new FormData;n.set(s,o),n.set("quantity",a),u(n,{info:{initiator:this}}),this.blur()}function v(t){const{quantityInputAttribute:e}=r.computed;if(!this.hasAttribute(e))return;const a=this,o=a.getAttribute(e).trim();let s;const n=b();if(n.status.cartStateSet){if(o.length>3)s=n.cart.items.find((t=>t.key===a.getAttribute(e).trim()));else{const t=Number(o)-1;s=n.cart.items[t]}s&&(a.value=s.quantity)}this.blur()}const _=new WeakMap;function $(t){const e=_.get(t);r.computed.productFormsProcessingClass&&(e>0?t.classList.add(r.computed.productFormsProcessingClass):t.classList.remove(r.computed.productFormsProcessingClass))}const T=(t,e)=>{const{messagesAttribute:a}=r.computed;let o,s,n,i,c,u,d=[];const l=b();if(t.requestBody instanceof FormData||t.requestBody instanceof URLSearchParams?(s=t.requestBody.get("line"),o=t.requestBody.get("id"),n=t.requestBody.get("quantity")):(s=t.requestBody.line,o=t.requestBody.id,n=t.requestBody.quantity),s){const t=Number(s);t>0&&l.status.cartStateSet&&(i=t-1,o=l.cart.items[i]?.key)}if(o){if(l.status.cartStateSet&&(l.cart.items.forEach((t=>{t.key!==o&&t.id!=o||d.push(t)})),u=l.cart.item_count),o.indexOf(":")>-1)void 0===s&&1===d.length&&(s=d[0].key),c=document.querySelectorAll(`[${a}="${o}"]`);else{const t=d.map((t=>`[${a}="${t.key}"]`));c=document.querySelectorAll(t.join(","))}c.length>0&&c.forEach((t=>{t.innerHTML=""}))}e((t=>{const{lineItemQuantityErrorText:e,messageBuilder:a}=r,{messagesAttribute:s}=r.computed;let i=[];const d=[];if(t.responseData?.ok){o&&(i=t.responseData.body.items.reduce(((t,e)=>(e.key!==o&&e.id!=o||t.push(e),t)),[])),i.forEach((e=>{e.quantity<n&&u===t.responseData.body.item_count&&d.push(e)}));const r=d.reduce(((t,e)=>(t.push(`[${s}="${e.key}"]`),t)),[]);c=[],r.length>0&&(c=document.querySelectorAll(r.join(","))),c.forEach((r=>{r.innerHTML=a([{type:"error",text:e,code:"line_item_quantity_error",requestState:t}])}))}else{const e=R(t);if(c=[],o)if(o.indexOf(":")>-1)c=document.querySelectorAll(`[${s}="${o}"]`);else{i=[];const t=b();t.status.cartStateSet&&t.cart.items.forEach((t=>{t.key!==o&&t.id!=o||i.push(t)}));const e=i.map((t=>`[${s}="${t.key}"]`));c=document.querySelectorAll(e.join(","))}c.length>0&&c.forEach((t=>{t.innerHTML=a([e])}))}}))},B=(t,e)=>{const a=t.info?.initiator;let o;a instanceof HTMLFormElement&&(o=a.querySelectorAll(`[${r.computed.messagesAttribute}="form"]`),o.length>0&&o.forEach((t=>{t.innerHTML=""}))),e((t=>{const{messageBuilder:e}=r,a=R(t);a&&o&&o.forEach((t=>{t.innerHTML=e([a])}))}))},R=t=>{const{requestErrorText:e}=r;if(!t.responseData?.ok){if("responseData"in t){if("description"in t.responseData.body)return{type:"error",text:t.responseData.body.description,code:"shopify_error",requestState:t};if("message"in t.responseData.body)return{type:"error",text:t.responseData.body.message,code:"shopify_error",requestState:t}}return{type:"error",text:e,code:"request_error",requestState:t}}},k=t=>{const{cartStateSetBodyClass:e,requestInProgressBodyClass:a,emptyCartBodyClass:o,notEmptyCartBodyClass:s}=r.computed;e&&(t.status.cartStateSet?document.body.classList.add(e):document.body.classList.remove(e)),a&&(t.status.requestInProgress?document.body.classList.add(a):document.body.classList.remove(a)),o&&(t.status.cartStateSet&&0===t.cart.item_count?document.body.classList.add(o):document.body.classList.remove(o)),s&&(t.status.cartStateSet&&0===t.cart.item_count?document.body.classList.remove(s):document.body.classList.add(s))};"liquidAjaxCart"in window||((()=>{const t=document.querySelector(`[${r.computed.configurationAttribute}]`);if(t)try{const e=JSON.parse(t.textContent),o=["productFormsFilter","messageBuilder"];for(let t in e)o.includes(t)?console.error(`Liquid Ajax Cart: the "${t}" parameter is not supported inside the "${r.computed.configurationAttribute}" script — use the "configureCart" function for it`):a(t,e[t])}catch(t){console.error(`Liquid Ajax Cart: can't parse configuration JSON from the "${r.computed.configurationAttribute}" script`),console.error(t)}})(),(()=>{p(((t,e)=>{m.all++,g(),e((t=>{(t=>{m.all--,"responseData"in t&&t.responseData.ok&&("add"===t.requestType?"extraResponseData"in t&&t.extraResponseData.ok?h=t.extraResponseData.body:i():h=t.responseData.body)})(t),g()}))}));const t=document.querySelector(`[${r.computed.initialStateAttribute}]`);if(t)try{const e=JSON.parse(t.textContent);if(!("item_count"in e))throw`JSON from ${r.computed.initialStateAttribute} script is not correct cart object`;h=e,g()}catch(t){console.error(`Liquid Ajax Cart: can't parse cart JSON from the "${r.computed.initialStateAttribute}" script. A /cart.js request will be performed to receive the cart state`),console.error(t),i()}else i()})(),q(S),S(b()),p(((t,e)=>{const{sectionsAttribute:a,sectionScrollAreaAttribute:o}=r.computed;if(void 0!==t.requestBody){const e=[];document.querySelectorAll(`[${a}]`).forEach((t=>{const r=t.closest('[id^="shopify-section-"]');if(r){const t=r.id.replace("shopify-section-","");-1===e.indexOf(t)&&e.push(t)}})),e.length&&(t.requestBody instanceof FormData||t.requestBody instanceof URLSearchParams?t.requestBody.append("sections",e.join(",")):t.requestBody.sections=e.join(","))}e((t=>{const{sectionsAttribute:e,sectionScrollAreaAttribute:a}=r.computed,o=new DOMParser;if(t.responseData?.ok&&"sections"in t.responseData.body){const r=t.responseData.body.sections;for(let t in r)r[t]?document.querySelectorAll(`#shopify-section-${t}`).forEach((s=>{const n="__noId__",i={};s.querySelectorAll(` [${a}] `).forEach((t=>{let e=t.getAttribute(a).toString().trim();""===e&&(e=n),e in i||(i[e]=[]),i[e].push(t.scrollTop)}));const c=s.querySelectorAll(`[${e}]`);if(c){const a=o.parseFromString(r[t],"text/html"),n=a.querySelectorAll(`[${e}]`);if(c.length!==n.length){console.error(`Liquid Ajax Cart: the received HTML for the "${t}" section has a different quantity of the "${e}" containers. The section will be updated completely.`);const r=a.querySelector(`#shopify-section-${t}`);r&&(s.innerHTML=r.innerHTML)}else c.forEach(((t,e)=>{t.before(n[e]),t.parentElement.removeChild(t)}))}for(let t in i)s.querySelectorAll(` [${a}="${t.replace(n,"")}"] `).forEach(((e,r)=>{r+1<=i[t].length&&(e.scrollTop=i[t][r])}))})):console.error(`Liquid Ajax Cart: the HTML for the "${t}" section was requested but the response is ${r[t]}`)}}))})),document.addEventListener("click",(function(t){for(var e=t.target;e&&e!=this;e=e.parentNode)L.call(e,t),w.call(e,t)}),!1),document.addEventListener("change",(function(t){E.call(t.target,t)}),!1),document.addEventListener("keydown",(function(t){"Enter"===t.key&&E.call(t.target,t),"Escape"===t.key&&v.call(t.target,t)}),!1),q((function(t){const{quantityInputAttribute:e}=r.computed;t.status.requestInProgress?document.querySelectorAll(`[${e}]`).forEach((t=>{t.readOnly=!0})):document.querySelectorAll(`[${e}]`).forEach((r=>{const a=r.getAttribute(e).trim();if(t.status.cartStateSet){let e;if(a.length>3)e=t.cart.items.find((t=>t.key===a));else{const r=Number(a)-1;e=t.cart.items[r]}r.value=e?e.quantity:0}r.readOnly=!1}))})),document.addEventListener("submit",(t=>{const e=t.target;let a;if("/cart/add"!==new URL(t.target.action).pathname)return;if("productFormsFilter"in r&&!r.productFormsFilter(e))return;if(t.preventDefault(),a=_.get(e),a>0||(a=0),a>0)return;const o=new FormData(e);_.set(e,a+1),$(e),c(o,{lastComplete:t=>{const r=_.get(e);r>0&&_.set(e,r-1),$(e)},info:{initiator:e}})})),p(((t,e)=>{const r={};r.add=B,r.change=T,t.requestType in r&&r[t.requestType](t,e)})),q(k),k(b()),window.liquidAjaxCart={configureCart:a,cartRequestGet:i,cartRequestAdd:c,cartRequestChange:u,cartRequestUpdate:d,cartRequestClear:l,subscribeToCartAjaxRequests:p,getCartState:b,subscribeToCartStateUpdate:q},window.addEventListener("focus",(()=>{r.updateOnWindowFocus&&d()})));const D=liquidAjaxCart.configureCart,F=liquidAjaxCart.cartRequestGet,M=liquidAjaxCart.cartRequestAdd,P=liquidAjaxCart.cartRequestChange,O=liquidAjaxCart.cartRequestUpdate,U=liquidAjaxCart.cartRequestClear,I=liquidAjaxCart.subscribeToCartAjaxRequests,N=liquidAjaxCart.getCartState,H=liquidAjaxCart.subscribeToCartStateUpdate;var J=e.x$,G=e.nd,Q=e.yF,W=e.fi,K=e.Be,X=e.ih,Y=e.KJ,z=e.Q4,V=e.w0;export{J as cartRequestAdd,G as cartRequestChange,Q as cartRequestClear,W as cartRequestGet,K as cartRequestUpdate,X as configureCart,Y as getCartState,z as subscribeToCartAjaxRequests,V as subscribeToCartStateUpdate};