var t={d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{x$:()=>n,nd:()=>i,fi:()=>a,jQ:()=>l,KJ:()=>h,Q4:()=>c,w0:()=>g});const r=[],o=t=>{switch(t){case"add":return"/cart/add.js";case"change":return"/cart/change.js";case"get":return"/cart.js";default:return}},s=(t,e,s)=>{const a=o(t),n="get"===t?void 0:{...e},i="get"===t?"GET":"POST",c=void 0===s?[]:[s],u={requestType:t,endpoint:a};r.forEach((e=>{try{e({requestType:t,endpoint:a,requestBody:n},(t=>c.push(t)))}catch(t){console.error("Liquid Ajax Cart: Error during Ajax request subscriber callback in ajax-api"),console.error(t)}})),u.requestBody=n;const d={method:i,headers:{"Content-Type":"application/json"}};return"get"!==t&&(d.body=JSON.stringify(n)),fetch(a,d).then((t=>t.json().then((e=>({ok:t.ok,status:t.status,body:e}))))).then((e=>(u.responseData=e,"add"!==t?u:fetch(o("get"),{method:"GET",headers:{"Content-Type":"application/json"}}).then((t=>t.json().then((e=>(u.extraResponseData={ok:t.ok,status:t.status,body:e},u)))))))).catch((t=>{throw console.error("Liquid Ajax Cart: Error while performing cart Ajax request"),console.error(t),u.fetchError=t,u})).finally((()=>{c.forEach((t=>{try{t(u)}catch(t){console.error("Liquid Ajax Cart: Error during Ajax request result callback in ajax-api"),console.error(t)}}))}))},a=t=>s("get",void 0,t),n=(t,e)=>s("add",t,e),i=(t,e)=>s("change",t,e),c=t=>{r.push(t)},u={dataAttributePrefix:"data-ajax-cart",cssClassesPrefix:"js-ajax-cart",productFormsFilter:t=>!0,requestInProgressBodyClass:"js-ajax-cart-request-in-progress",cartStateSetBodyClass:"js-ajax-cart-set",emptyCartBodyClass:"js-ajax-cart-empty",productFormsIgnoreSubmitOnProcessing:!0,productFormsProcessingClass:"js-ajax-cart-form-in-progress",productFormsButtonProcessingClass:"js-ajax-cart-button-in-progress",productFormsButtonProcessingDisabledAttribute:!1};let d={};const l=(t={})=>{d={...u,...t},d.computed={productFormsErrorsAttribute:`${d.dataAttributePrefix}-form-error`,sectionsAttribute:`${d.dataAttributePrefix}-section`,binderAttribute:`${d.dataAttributePrefix}-bind-state`,quantityButtonAttribute:`${d.dataAttributePrefix}-quantity-button`,toggleClassButtonAttribute:`${d.dataAttributePrefix}-toggle-class-button`,toggleClassPrefix:`${d.cssClassesPrefix}-toggle-`,initialStateAttribute:`${d.dataAttributePrefix}-initial-state`,sectionScrollAreaAttribute:`${d.dataAttributePrefix}-section-scroll`}};l();const p={all:0},m=[];let f={},y={requestInProgress:!1,cartStateSet:!1};const b=()=>{y.requestInProgress=p.all>0,y.cartStateSet="item_count"in f,A()},g=t=>{try{t({cart:f,status:y}),m.push(t)}catch(t){console.log("Liquid Ajax Cart: Error during subscribing to the state"),console.error(t)}},h=()=>({cart:f,status:y}),A=()=>{m.forEach((t=>{try{t({cart:f,status:y})}catch(t){console.error(t)}}))};(()=>{c(((t,e)=>{p.all++,b(),e((t=>{(t=>{p.all--,"responseData"in t&&t.responseData.ok&&("add"===t.requestType?"extraResponseData"in t&&t.extraResponseData.ok?f=t.extraResponseData.body:a():f=t.responseData.body)})(t),b()}))}));const t=document.querySelector(`[${d.computed.initialStateAttribute}]`);if(t)try{const e=JSON.parse(t.textContent);if(!("item_count"in e))throw`JSON from ${d.computed.initialStateAttribute} script is not correct cart object`;f=e,b()}catch(t){console.error(`Can't parse cart JSON from ${d.computed.initialStateAttribute} script`),console.error(t),a()}else a()})();const S=d.computed.binderAttribute,q=t=>{const[e,...r]=t.split("|");let o=x(e);return r.forEach((t=>{const e=t.trim();""!==e&&e in j&&(o=j[e](o))})),o};function x(t,e=h()){h();const r=t.split("."),o=r.shift().trim();return o in e&&r.length>0?x(r.join("."),e[o]):e[o]}const j={amount:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount }}")},amount_no_decimals:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount_no_decimals }}")},amount_with_comma_separator:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount_with_comma_separator }}")},amount_no_decimals_with_comma_separator:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount_no_decimals_with_comma_separator }}")},amount_with_apostrophe_separator:t=>{if("Shopify"in window&&"formatMoney"in Shopify)return Shopify.formatMoney(t,"{{ amount_with_apostrophe_separator }}")}};function C(t){t.preventDefault();const{quantityButtonAttribute:e}=d.computed;h();{const[t,r]=this.getAttribute(e).split("|");i({id:t.trim(),quantity:parseInt(r.trim())})}}function P(t){t.preventDefault();const{toggleClassButtonAttribute:e}=d.computed,r=this.getAttribute(e).split("|");if(!r)return void console.error("Liquid Ajax Cart: Error while toggling body class");const o=r[0].trim();let s=r[1]?r[1].trim():"toggle";if("add"!==s&&"remove"!==s&&(s="toggle"),o)try{"add"===s?document.body.classList.add(o):"remove"===s?document.body.classList.remove(o):document.body.classList.toggle(o)}catch(t){console.error("Liquid Ajax Cart: Error while toggling body class:",o),console.error(t)}}g((t=>{t.status.cartStateSet&&document.querySelectorAll(`[${S}]`).forEach((t=>{const e=t.getAttribute(S),r=q(e);void 0!==r&&(t.innerText=r)}))})),c(((t,e)=>{const{sectionsAttribute:r,sectionScrollAreaAttribute:o}=d.computed;if(void 0!==t.requestBody){const e=[];document.querySelectorAll(`[${r}]`).forEach((t=>{let r=t.parentElement.id;if(0===r.indexOf("shopify-section-")){const t=r.replace("shopify-section-","");-1===e.indexOf(t)&&e.push(t)}})),e.length&&(t.requestBody.sections=e.join(","))}e((t=>{const{sectionsAttribute:e,sectionScrollAreaAttribute:r}=d.computed;if("responseData"in t&&t.responseData.ok&&"sections"in t.responseData.body){const o=t.responseData.body.sections;for(let t in o)document.querySelectorAll(`#shopify-section-${t} > [${e}]`).forEach((e=>{const s="__noId__",a={},n=e.parentNode;e.parentNode.querySelectorAll(` [${r}] `).forEach((t=>{let e=t.getAttribute(r).toString().trim();""===e&&(e=s),e in a||(a[e]=[]),a[e].push(t.scrollTop)})),n.insertAdjacentHTML("beforeBegin",o[t]);const i=n.previousSibling;n.parentElement.removeChild(n);for(let t in a)i.querySelectorAll(` [${r}="${t.replace(s,"")}"] `).forEach(((e,r)=>{r+1<=a[t].length&&(e.scrollTop=a[t][r])}))}))}}))})),document.addEventListener("click",(function(t){const{quantityButtonAttribute:e,toggleClassButtonAttribute:r}=d.computed;for(var o=t.target;o&&o!=this;o=o.parentNode){if(o.matches(`[${e}]`)){C.call(o,t);break}if(o.matches(`[${r}]`)){P.call(o,t);break}}}),!1);const _=new WeakMap;function E(t,e=""){t.querySelectorAll(`[${d.computed.productFormsErrorsAttribute}]`).forEach((t=>{t.innerText=e||""})),t.querySelectorAll("input[type=submit], button[type=submit]");const r=_.get(t);d.productFormsProcessingClass&&(r>0?t.classList.add(d.productFormsProcessingClass):t.classList.remove(d.productFormsProcessingClass)),(d.productFormsButtonProcessingClass||d.productFormsButtonProcessingDisabledAttribute)&&t.querySelectorAll("input[type=submit], button[type=submit]").forEach((t=>{r>0?(d.productFormsButtonProcessingClass&&t.classList.add(d.productFormsButtonProcessingClass),d.productFormsButtonProcessingDisabledAttribute&&(t.disabled=!0)):(d.productFormsButtonProcessingClass&&t.classList.remove(d.productFormsButtonProcessingClass),d.productFormsButtonProcessingDisabledAttribute&&(t.disabled=!1))}))}document.addEventListener("submit",(t=>{const e=t.target;let r,o="";if("/cart/add"!==new URL(t.target.action).pathname)return;if("productFormsFilter"in d&&!d.productFormsFilter(e))return;if(t.preventDefault(),r=_.get(e),r>0||(r=0),d.productFormsIgnoreSubmitOnProcessing&&r>0)return;const s=new FormData(e),a={};for(let t of s){const e=t[0],r=t[1];["quantity","id","selling_plan"].includes(e)&&(a[e]=r),0===e.indexOf("properties[")&&"]"===e.slice(-1)&&("properties"in a||(a.properties={}),a.properties[e.slice(11,-1)]=r)}if(!("id"in a))return;let i;"quantity"in a||(a.quantity=1),_.set(e,r+1),E(e),n({items:[a]}).then((t=>{i=t})).catch((t=>{i=t})).finally((()=>{"responseData"in i?i.responseData.ok||(o="description"in i.responseData.body?i.responseData.body.description:"message"in i.responseData.body?i.responseData.body.message:`Error ${i.responseData.status}`):"fetchError"in i&&(o=i.fetchError);const t=_.get(e);t>0&&_.set(e,t-1),E(e,o)}))})),g((t=>{const{cartStateSetBodyClass:e,requestInProgressBodyClass:r,emptyCartBodyClass:o}=d;e&&(t.status.cartStateSet?document.body.classList.add(e):document.body.classList.remove(e)),r&&(t.status.requestInProgress?document.body.classList.add(r):document.body.classList.remove(r)),o&&(t.status.cartStateSet&&0===t.cart.item_count?document.body.classList.add(o):document.body.classList.remove(o))}));var w=e.x$,B=e.nd,D=e.fi,v=e.jQ,F=e.KJ,$=e.Q4,L=e.w0;export{w as cartRequestAdd,B as cartRequestChange,D as cartRequestGet,v as configure,F as getCartState,$ as subscribeToCartAjaxRequests,L as subscribeToCartStateUpdate};